<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: Connect to an Existing Post - 10up Distributor Developer Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">

	<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:300,400|Playfair+Display:900&display=swap" rel="stylesheet"> 
    <link type="text/css" rel="stylesheet" href="styles-10up.css">
</head>

<body>

<div id="main">

	
    <h1 class="page-title">Tutorial: Connect to an Existing Post</h1>
	

    <section>

<header>
    

    <h2>Connect to an Existing Post</h2>
</header>

<article>
    <p>In a scenario where you have existing sites that share content and that content was in place prior to the addition of Distributor, it is useful to be able to connect that content together without having to delete one and push/pull the other one. Behind the scenes, Distributor stores a handful of details in post meta, so these details will need to be manually added for the links to work.</p>
<p>At it's simplest, you'll need to connect the two sites together and then add the proper meta (as detailed below) for the items that should be linked together, both on the source site and the receiving site.</p>
<h2 id="network-connections">Network Connections</h2>
<p>There are different pieces of data that will need to be set on each side of a connection, what we'll call as the source site and the receiving site.</p>
<p>The only piece of data needed on the source site to connect two items in Network Connections is the <code>dt_connection_map</code>. This is a serialized array of data that contains the mapping from the site ID to the post ID, along with a timestamp of when the item was linked. Note that the site ID and post ID should correspond to the data on the receiving site, not source site.</p>
<p>This data structure will look like the following:</p>
<pre class="prettyprint source lang-php"><code>$data = [
  [
    'external' => [],
    'internal' => [
      2 => [
        'post_id' => 674,
        'time'    => 1693494494,
      ],
    ],
  ],
];
</code></pre>
<p>In the above example, the <code>external</code> array will always be empty, unless an item is also linked to an external site. For the <code>internal</code> array, each item in the array will have a key that corresponds to the site ID (2 in the example above) and then the <code>post_id</code> should be the destination post ID.</p>
<p>As a further example, if I have a post with an ID of 100 that lives on a site with an ID of 1 and I want that post to be linked to an existing post with an ID of 50 on the site with an ID of 2, the <code>dt_connection_map</code> data that is stored with the original item (ID of 100, site ID 1) would look like the following:</p>
<pre class="prettyprint source lang-php"><code>$data = [
  [
    'external' => [],
    'internal' => [
      2 => [
        'post_id' => 50,
        'time'    => 1693494494,
      ],
    ],
  ],
];
update_post_meta( 100, 'dt_connection_map', $data );
</code></pre>
<p>And then on the receiving site, the following data is needed: <code>dt_original_post_id</code>, <code>dt_original_post_url</code>, <code>dt_original_blog_id</code> and <code>dt_syndicate_time</code>. These should all be fairly self explanatory but to use the same example from above:</p>
<ul>
<li><code>dt_original_post_id</code> would be set to 100</li>
<li><code>dt_original_post_url</code> would be the full URL of that post with an ID of 100</li>
<li><code>dt_original_blog_id</code> would be set to 1</li>
<li><code>dt_syndicate_time</code> should match the same timestamp set in the connection map, in this case 1693494494</li>
</ul>
<h2 id="external-connections">External Connections</h2>
<p>External Connections share a similar data structure as detailed above but they also contain a Subscriptions piece, which is more complicated to manually replicate (as such, full details on how to replicate the Subscription is not outlined here).</p>
<p>Similar to the above, there's a data mapping that is needed on the source site: <code>dt_connection_map</code>. This is a serialized array of data that contains the mapping from the external connection ID to the post ID, along with a timestamp of when the item was linked. Note that the post ID should correspond to the data on the receiving site, not source site.</p>
<p>This data structure will look like the following:</p>
<pre class="prettyprint source lang-php"><code>$data = [
  [
    'external' => [
      2 => [
        'post_id' => 50,
        'time'    => 1693494494,
      ],
    ],
    'internal' => [],
  ],
];
</code></pre>
<p>In the above example, the <code>internal</code> array will always be empty, unless an item is also linked to an interal site. For the <code>external</code> array, each item in the array will have a key that corresponds to the connection ID (2 in the example above) and then the <code>post_id</code> should be the destination post ID.</p>
<p>As a further example, if I have a post with an ID of 100 that lives on a site with an ID of 1 and I want that post to be linked to an existing post with an ID of 50 on the site with a connection ID of 2, the <code>dt_connection_map</code> data that is stored with the original item (ID of 100, site ID 1) would look like the following:</p>
<pre class="prettyprint source lang-php"><code>$data = [
  [
    'external' => [
      2 => [
        'post_id' => 50,
        'time'    => 1693494494,
      ],
    ],
    'internal' => [],
  ],
];
update_post_meta( 100, 'dt_connection_map', $data );
</code></pre>
<p>In addition, there needs to be a piece of data on the source site that contains the subscription information: <code>dt_subscriptions</code>. This contains a serialized array of data that links a hashed signature to the subscription post ID. This isn't something that is easily manually reproduced. Suggestion is to look at using the existing <code>Distributor\Subscriptions\create_subscription</code> function to replicate this data.</p>
<p>And then on the receiving site, the following data is needed: <code>dt_original_post_id</code>, <code>dt_original_post_url</code>, <code>dt_original_source_id</code>, <code>dt_original_site_name</code>, <code>dt_original_site_url</code>, <code>dt_subscription_signature</code>, <code>dt_full_connection</code> and <code>dt_syndicate_time</code>.</p>
<p>From the example above:</p>
<ul>
<li><code>dt_original_post_id</code> would be set to 100</li>
<li><code>dt_original_post_url</code> would be the full URL of that post with an ID of 100</li>
<li><code>dt_original_source_id</code> would be set to 2 (the source connection ID)</li>
<li><code>dt_original_site_name</code> would be the name of the source site</li>
<li><code>dt_original_site_url</code> would be the URL of the source site</li>
<li><code>dt_subscription_signature</code> would be the signature of the subscription mentioned above</li>
<li><code>dt_full_connection</code> would be set to <code>true</code></li>
<li><code>dt_syndicate_time</code> should match the same timestamp set in the connection map, in this case 1693494494</li>
</ul>
</article>

</section>


    <footer>
		<a href="https://distributorplugin.com/">Distributor Plugin</a> &bull;
		<a href="https://github.com/10up/distributor/">Distributor on GitHub</a> &bull;
		<a href="https://10up.com/careers">Careers at 10up</a>
	</footer>

</div>

<nav>
	
	<h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-connect-to-an-existing-post.html">Connect to an Existing Post</a></li><li><a href="tutorial-exclude-meta-from-yoast-duplicate-post.html">Exclude Meta from Yoast Duplicate Post</a></li><li><a href="tutorial-migration-guide-version-1-to-version-2.html">Migration Guide Version 1 to Version 2</a></li><li><a href="tutorial-post-meta.html">Post Meta</a></li><li><a href="tutorial-snippets.html">Snippets</a></li></ul><h3>Actions</h3><ul><li><a href="dt_after_set_meta.html">dt_after_set_meta</a></li><li><a href="dt_before_set_meta.html">dt_before_set_meta</a></li><li><a href="dt_link_post.html">dt_link_post</a></li><li><a href="dt_log_sync.html">dt_log_sync</a></li><li><a href="dt_oauth_admin_notices.html">dt_oauth_admin_notices</a></li><li><a href="dt_prepared_taxonomy_terms.html">dt_prepared_taxonomy_terms</a></li><li><a href="dt_process_distributor_attributes.html">dt_process_distributor_attributes</a></li><li><a href="dt_process_subscription_attributes.html">dt_process_subscription_attributes</a></li><li><a href="dt_pull_filters.html">dt_pull_filters</a></li><li><a href="dt_pull_list_table_custom_column.html">dt_pull_list_table_custom_column</a></li><li><a href="dt_pull_post.html">dt_pull_post</a></li><li><a href="dt_push_external_post.html">dt_push_external_post</a></li><li><a href="dt_push_network_post.html">dt_push_network_post</a></li><li><a href="dt_push_post.html">dt_push_post</a></li><li><a href="dt_unlink_post.html">dt_unlink_post</a></li></ul><h3>Filters</h3><ul><li><a href="distributable_post_types.html">distributable_post_types</a></li><li><a href="distributor_get_original_site_link.html">distributor_get_original_site_link</a></li><li><a href="dt_ajax_requires_with_credentials.html">dt_ajax_requires_with_credentials</a></li><li><a href="dt_allow_post_unlink.html">dt_allow_post_unlink</a></li><li><a href="dt_allowed_media_extensions.html">dt_allowed_media_extensions</a></li><li><a href="dt_auth_format_get_args.html">dt_auth_format_get_args</a></li><li><a href="dt_auth_format_post_args.html">dt_auth_format_post_args</a></li><li><a href="dt_auth_prepare_credentials.html">dt_auth_prepare_credentials</a></li><li><a href="dt_authorized_sites.html">dt_authorized_sites</a></li><li><a href="dt_available_pull_post_types.html">dt_available_pull_post_types</a></li><li><a href="dt_available_push_post_types.html">dt_available_push_post_types</a></li><li><a href="dt_capabilities.html">dt_capabilities</a></li><li><a href="dt_create_missing_terms.html">dt_create_missing_terms</a></li><li><a href="dt_debug_info_enabled.html">dt_debug_info_enabled</a></li><li><a href="dt_distributable_post_statuses.html">dt_distributable_post_statuses</a></li><li><a href="dt_excluded_meta.html">dt_excluded_meta</a></li><li><a href="dt_external_capabilities.html">dt_external_capabilities</a></li><li><a href="dt_get_media_details.html">dt_get_media_details</a></li><li><a href="dt_get_pull_content_rest_query_args.html">dt_get_pull_content_rest_query_args</a></li><li><a href="dt_get_rest_url.html">dt_get_rest_url</a></li><li><a href="dt_item_mapping.html">dt_item_mapping</a></li><li><a href="dt_media_item_formatted.html">dt_media_item_formatted</a></li><li><a href="dt_media_processing_filename.html">dt_media_processing_filename</a></li><li><a href="dt_network_site_connection_enabled.html">dt_network_site_connection_enabled</a></li><li><a href="dt_parse_media_blocks.html">dt_parse_media_blocks</a></li><li><a href="dt_pre_get_authorized_sites.html">dt_pre_get_authorized_sites</a></li><li><a href="dt_prepared_meta.html">dt_prepared_meta</a></li><li><a href="dt_process_media_args.html">dt_process_media_args</a></li><li><a href="dt_process_media_save_source_file_path.html">dt_process_media_save_source_file_path</a></li><li><a href="dt_pull_as_draft.html">dt_pull_as_draft</a></li><li><a href="dt_pull_capabilities.html">dt_pull_capabilities</a></li><li><a href="dt_pull_list_table_columns.html">dt_pull_list_table_columns</a></li><li><a href="dt_pull_list_table_tr_class.html">dt_pull_list_table_tr_class</a></li><li><a href="dt_pull_post_apply_rendered_content.html">dt_pull_post_apply_rendered_content</a></li><li><a href="dt_pull_post_args.html">dt_pull_post_args</a></li><li><a href="dt_pull_post_media.html">dt_pull_post_media</a></li><li><a href="dt_pull_post_meta.html">dt_pull_post_meta</a></li><li><a href="dt_pull_post_terms.html">dt_pull_post_terms</a></li><li><a href="dt_push_capabilities.html">dt_push_capabilities</a></li><li><a href="dt_push_post_args.html">dt_push_post_args</a></li><li><a href="dt_push_post_media.html">dt_push_post_media</a></li><li><a href="dt_push_post_meta.html">dt_push_post_meta</a></li><li><a href="dt_push_post_terms.html">dt_push_post_terms</a></li><li><a href="dt_push_post_timeout.html">dt_push_post_timeout</a></li><li><a href="dt_remote_get.html">dt_remote_get</a></li><li><a href="dt_remote_post.html">dt_remote_post</a></li><li><a href="dt_remote_post_query_args.html">dt_remote_post_query_args</a></li><li><a href="dt_remote_post_timeout.html">dt_remote_post_timeout</a></li><li><a href="dt_set_media_args.html">dt_set_media_args</a></li><li><a href="dt_subscription_post_args.html">dt_subscription_post_args</a></li><li><a href="dt_subscription_post_timeout.html">dt_subscription_post_timeout</a></li><li><a href="dt_sync_media_delete_and_replace.html">dt_sync_media_delete_and_replace</a></li><li><a href="dt_sync_meta.html">dt_sync_meta</a></li><li><a href="dt_syncable_taxonomies.html">dt_syncable_taxonomies</a></li><li><a href="dt_syndicatable_capabilities.html">dt_syndicatable_capabilities</a></li><li><a href="dt_update_content_via_request_args.html">dt_update_content_via_request_args</a></li><li><a href="dt_update_term_hierarchy.html">dt_update_term_hierarchy</a></li><li><a href="dt_use_block_editor_for_post_type.html">dt_use_block_editor_for_post_type</a></li></ul>
</nav>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>