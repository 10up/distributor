!function(e){function t(a){if(n[a])return n[a].exports;var d=n[a]={i:a,l:!1,exports:{}};return e[a].call(d.exports,d,d.exports,t),d.l=!0,d.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t){e.exports=window},function(e,t){e.exports=jQuery},function(e,t){e.exports=_},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function d(){if(!1!==b&&b.abort(),""===c.value)return v.innerText="",h.innerText="",void h.removeAttribute("data-endpoint-state");h.setAttribute("data-endpoint-state","loading"),h.innerText=l.dt.endpoint_checking_message,v.innerText="";var e={};i.default.each(m,function(t){if(!t.disabled){var n=t.getAttribute("data-auth-field");n&&(e[n]=t.value)}});var t=0;_&&_.value&&(t=_.value),b=r.default.ajax({url:l.ajaxurl,method:"post",data:{nonce:l.dt.nonce,action:"dt_verify_external_connection",auth:e,url:c.value,type:f.value,endpoint_id:t}}).done(function(e){if(e.success)if(e.data.errors.no_external_connection)if(h.setAttribute("data-endpoint-state","error"),e.data.endpoint_suggestion){h.innerText=l.dt.endpoint_suggestion+" ";var t=document.createElement("a");t.classList.add("suggest"),t.innerText=e.data.endpoint_suggestion,h.appendChild(t)}else h.innerText=l.dt.bad_connection;else if(e.data.errors.no_distributor||!e.data.can_post.length){h.setAttribute("data-endpoint-state","warning"),h.innerText=l.dt.limited_connection;var n=[];e.data.errors.no_distributor?h.innerText+=" "+l.dt.no_distributor:h.innerText+=" "+l.dt.bad_auth,n.push(l.dt.no_push),n.push(l.dt.pull_limited),n.forEach(function(e){var t=document.createElement("li");t.innerText=e,v.append(t)})}else h.setAttribute("data-endpoint-state","valid"),h.innerText=l.dt.good_connection;else h.setAttribute("data-endpoint-state","error")}).complete(function(){h.classList.remove("loading")})}var o=n(1),r=a(o),u=n(2),i=a(u),l=n(0),c=document.getElementsByClassName("external-connection-url-field")[0],s=document.getElementById("dt_external_connection_details"),f=document.getElementsByClassName("external-connection-type-field")[0],m=document.getElementsByClassName("auth-field"),p=document.getElementsByClassName("dt-roles-allowed"),g=document.getElementById("title"),h=document.querySelector(".endpoint-result"),v=document.querySelector(".endpoint-errors"),_=document.getElementById("post_ID"),b=!1;setTimeout(function(){d()},300),(0,r.default)(s).on("click",".suggest",function(e){c.value=e.currentTarget.innerText,(0,r.default)(c).trigger("input")}),(0,r.default)(s).on("keyup input",".auth-field, .external-connection-url-field",i.default.debounce(d,250)),(0,r.default)(c).on("blur",function(e){""===g.value&&""!==e.currentTarget.value&&(g.value=e.currentTarget.value.replace(/https?:\/\//i,""),g.focus(),g.blur())});var x=document.getElementById("dt_password"),y=document.getElementById("dt_username"),E=document.querySelector(".change-password");(0,r.default)(y).on("keyup change",i.default.debounce(function(){E&&(x.disabled=!1,x.value="",E.style.display="none")},250)),(0,r.default)(E).on("click",function(e){e.preventDefault(),x.disabled?(x.disabled=!1,x.value="",e.currentTarget.innerText=l.dt.cancel):(x.disabled=!0,x.value="sdfdsfsdfdsfdsfsd",e.currentTarget.innerText=l.dt.change),d()}),(0,r.default)(p).on("click",".dt-role-checkbox",function(e){e.target.classList.contains("dt-role-checkbox")&&e.target.checked&&"administrator"!==e.target.value&&"editor"!==e.target.value&&alert(l.dt.roles_warning)});var T=(0,r.default)(".hide-until-authed"),B=(0,r.default)(".auth-credentials"),w=(0,r.default)(document.getElementById("dt_client_secret")),I=(0,r.default)(document.getElementById("dt_client_id")),k=function(){0===document.getElementsByClassName("oauth-connection-established").length&&T.hide()},C=function(e,t){return""===e.val()?(t.preventDefault(),e.addClass("error-required"),!1):(e.removeClass("error-required"),!0)};(0,r.default)(f).on("change",function(){var e=f.value;B.hide(),(0,r.default)(".auth-credentials."+e).show(),"wpdotcom"===e?k():T.show()}),"wpdotcom"===f.value&&k();var A=document.getElementById("create-oauth-connection");A&&(0,r.default)(A).on("click",function(e){var t=C(w,e),n=C(I,e);if(!t||!n)return e.preventDefault(),!1});var j=document.getElementById("oauth-authentication-change-credentials"),q=(0,r.default)(".oauth-authentication-details-wrapper");j&&(0,r.default)(j).on("click",function(){q.show(),w.val(""),(0,r.default)(".oauth-connection-established").remove(),k()});var D=document.getElementById("begin-authorization");D&&(0,r.default)(D).on("click",function(e){var t=(0,r.default)(g),n=t.val();C(t,e)&&((0,r.default)(D).addClass("disabled"),t.removeClass("error-required"),r.default.ajax({url:l.ajaxurl,method:"post",data:{nonce:l.dt.nonce,action:"dt_begin_authorization",title:n,id:(0,r.default)(document.getElementById("post_ID")).val()}}).done(function(e){if(e.success&&e.data.id){var t=l.dt.admin_url+"post.php?post="+e.data.id+"&action=edit";history.pushState({},"Oauth Authorize Details",t),(0,r.default)(document.getElementById("dt_redirect_uri")).val(t),(0,r.default)(document.getElementById("dt_created_post_id")).val(e.data.id),(0,r.default)(document.getElementById("original_post_status")).val("publish"),(0,r.default)(".oauth-begin-authentication-wrapper").hide(),q.show()}}).complete(function(){(0,r.default)(D).removeClass("disabled")}))})}]);
//# sourceMappingURL=admin-external-connection.min.js.map