(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var n=e.n(t);const r=window._;var s=e.n(r),o=Object.prototype.toString,i=Array.isArray||function(e){return"[object Array]"===o.call(e)};function a(e){return"function"==typeof e}function c(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function l(e,t){return null!=e&&"object"==typeof e&&t in e}var d=RegExp.prototype.test,u=/\S/,p={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},h=/\s*/,f=/\s+/,g=/\s*=/,y=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;function m(e){this.string=e,this.tail=e,this.pos=0}function b(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function w(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}m.prototype.eos=function(){return""===this.tail},m.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},m.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},b.prototype.push=function(e){return new b(e,this)},b.prototype.lookup=function(e){var t,n,r,s=this.cache;if(s.hasOwnProperty(e))t=s[e];else{for(var o,i,c,d=this,u=!1;d;){if(e.indexOf(".")>0)for(o=d.view,i=e.split("."),c=0;null!=o&&c<i.length;)c===i.length-1&&(u=l(o,i[c])||(n=o,r=i[c],null!=n&&"object"!=typeof n&&n.hasOwnProperty&&n.hasOwnProperty(r))),o=o[i[c++]];else o=d.view[e],u=l(d.view,e);if(u){t=o;break}d=d.parent}s[e]=t}return a(t)&&(t=t.call(this.view)),t},w.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},w.prototype.parse=function(e,t){var n=this.templateCache,r=e+":"+(t||L.tags).join(":"),s=void 0!==n,o=s?n.get(r):void 0;return null==o&&(o=function(e,t){if(!e)return[];var n,r,s,o,a=!1,l=[],p=[],b=[],w=!1,T=!1,C="",k=0;function S(){if(w&&!T)for(;b.length;)delete p[b.pop()];else b=[];w=!1,T=!1}function x(e){if("string"==typeof e&&(e=e.split(f,2)),!i(e)||2!==e.length)throw new Error("Invalid tags: "+e);n=new RegExp(c(e[0])+"\\s*"),r=new RegExp("\\s*"+c(e[1])),s=new RegExp("\\s*"+c("}"+e[1]))}x(t||L.tags);for(var E,j,A,O,q,_,U=new m(e);!U.eos();){if(E=U.pos,A=U.scanUntil(n))for(var I=0,$=A.length;I<$;++I)o=O=A.charAt(I),function(e,t){return d.call(e,t)}(u,o)?(T=!0,a=!0,C+=" "):(b.push(p.length),C+=O),p.push(["text",O,E,E+1]),E+=1,"\n"===O&&(S(),C="",k=0,a=!1);if(!U.scan(n))break;if(w=!0,j=U.scan(v)||"name",U.scan(h),"="===j?(A=U.scanUntil(g),U.scan(g),U.scanUntil(r)):"{"===j?(A=U.scanUntil(s),U.scan(y),U.scanUntil(r),j="&"):A=U.scanUntil(r),!U.scan(r))throw new Error("Unclosed tag at "+U.pos);if(q=">"==j?[j,A,E,U.pos,C,k,a]:[j,A,E,U.pos],k++,p.push(q),"#"===j||"^"===j)l.push(q);else if("/"===j){if(!(_=l.pop()))throw new Error('Unopened section "'+A+'" at '+E);if(_[1]!==A)throw new Error('Unclosed section "'+_[1]+'" at '+E)}else"name"===j||"{"===j||"&"===j?T=!0:"="===j&&x(A)}if(S(),_=l.pop())throw new Error('Unclosed section "'+_[1]+'" at '+U.pos);return function(e){for(var t,n=[],r=n,s=[],o=0,i=e.length;o<i;++o)switch((t=e[o])[0]){case"#":case"^":r.push(t),s.push(t),r=t[4]=[];break;case"/":s.pop()[5]=t[2],r=s.length>0?s[s.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],s=0,o=e.length;s<o;++s)(t=e[s])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(p))}(e,t),s&&n.set(r,o)),o},w.prototype.render=function(e,t,n,r){var s=this.getConfigTags(r),o=this.parse(e,s),i=t instanceof b?t:new b(t,void 0);return this.renderTokens(o,i,n,e,r)},w.prototype.renderTokens=function(e,t,n,r,s){for(var o,i,a,c="",l=0,d=e.length;l<d;++l)a=void 0,"#"===(i=(o=e[l])[0])?a=this.renderSection(o,t,n,r,s):"^"===i?a=this.renderInverted(o,t,n,r,s):">"===i?a=this.renderPartial(o,t,n,s):"&"===i?a=this.unescapedValue(o,t):"name"===i?a=this.escapedValue(o,t,s):"text"===i&&(a=this.rawValue(o)),void 0!==a&&(c+=a);return c},w.prototype.renderSection=function(e,t,n,r,s){var o=this,c="",l=t.lookup(e[1]);if(l){if(i(l))for(var d=0,u=l.length;d<u;++d)c+=this.renderTokens(e[4],t.push(l[d]),n,r,s);else if("object"==typeof l||"string"==typeof l||"number"==typeof l)c+=this.renderTokens(e[4],t.push(l),n,r,s);else if(a(l)){if("string"!=typeof r)throw new Error("Cannot use higher-order sections without the original template");null!=(l=l.call(t.view,r.slice(e[3],e[5]),(function(e){return o.render(e,t,n,s)})))&&(c+=l)}else c+=this.renderTokens(e[4],t,n,r,s);return c}},w.prototype.renderInverted=function(e,t,n,r,s){var o=t.lookup(e[1]);if(!o||i(o)&&0===o.length)return this.renderTokens(e[4],t,n,r,s)},w.prototype.indentPartial=function(e,t,n){for(var r=t.replace(/[^ \t]/g,""),s=e.split("\n"),o=0;o<s.length;o++)s[o].length&&(o>0||!n)&&(s[o]=r+s[o]);return s.join("\n")},w.prototype.renderPartial=function(e,t,n,r){if(n){var s=this.getConfigTags(r),o=a(n)?n(e[1]):n[e[1]];if(null!=o){var i=e[6],c=e[5],l=e[4],d=o;0==c&&l&&(d=this.indentPartial(o,l,i));var u=this.parse(d,s);return this.renderTokens(u,t,n,d,r)}}},w.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},w.prototype.escapedValue=function(e,t,n){var r=this.getConfigEscape(n)||L.escape,s=t.lookup(e[1]);if(null!=s)return"number"==typeof s&&r===L.escape?String(s):r(s)},w.prototype.rawValue=function(e){return e[1]},w.prototype.getConfigTags=function(e){return i(e)?e:e&&"object"==typeof e?e.tags:void 0},w.prototype.getConfigEscape=function(e){return e&&"object"==typeof e&&!i(e)?e.escape:void 0};var L={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(e){T.templateCache=e},get templateCache(){return T.templateCache}},T=new w;L.clearCache=function(){return T.clearCache()},L.parse=function(e,t){return T.parse(e,t)},L.render=function(e,t,n,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(i(s=e)?"array":typeof s)+'" was given as the first argument for mustache#render(template, view, partials)');var s;return T.render(e,t,n,r)},L.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return p[e]}))},L.Scanner=m,L.Context=b,L.Writer=w;const C=L,k=window.wp.i18n,{document:S,dt:x}=window;let E="",j={},A="";const O=s().memoize((e=>{const t=S.getElementById(e);return!!t&&(t.attributes.template?(C.parse(t.innerHTML),"mustache"):s().template(t.innerHTML,null,{evaluate:/<#([\s\S]+?)#>/g,interpolate:/{{{([\s\S]+?)}}}/g,escape:/{{([^}]+?)}}(?!})/g}))}));n()(window).on("load",(()=>{const e=S.querySelector("#wp-admin-bar-distributor #wp-admin-bar-distributor-placeholder"),t=S.querySelector("#distributor-push-wrapper");if(!e||!t)return;let r="",o="",i="",a="",c="",l="",d="",u="",p="",h="",f="";e.appendChild(t);const g=S.createElement("div");g.id="distributor-overlay";const y=S.querySelector("#wp-admin-bar-distributor");function v(){a=t.querySelector(".new-connections-list"),null!==a&&(c=a.querySelectorAll(".add-connection"),s().each(c,(e=>{e.classList.contains("syndicated")&&(e.disabled=!0)})))}function m(e){t.classList.add("message-error"),f.innerText="",s().each(function(e){return s().isArray(e)?s().map(e,(function(e){return s().isString(e)?e:s().has(e,"message")?e.message:void 0})):[e]}(e),(function(e){const t=S.createElement("li");t.innerText=e,f.appendChild(t)}))}function b(){a.innerText="";const e=O("dt-add-connection");let t="";s().each(r,(n=>{if(""!==A){const e=n.name.replace(/[^0-9a-zA-Z ]+/,"").toLowerCase().match(A.toLowerCase()),t=n.url.replace(/https?:\/\//i,"").replace(/www/i,"").replace(/[^0-9a-zA-Z ]+/,"").toLowerCase().match(A.toLowerCase());if(!e&&!t)return}"mustache"===e?(j[n.type+n.id]?n.added=!0:n.added=!1,"internal"===n.type&&(n.internal=!0),t=C.render(S.getElementById("dt-add-connection").innerHTML,{connection:n})):t=e({connection:n,selectedConnections:j}),a.innerHTML+=t})),""===a.innerHTML&&(a.innerHTML='<p class="no-results">No results</p>'),"mustache"===e&&v()}function w(e){switch(e){case"addEmpty":o.classList.add("empty");break;case"removeEmpty":o.classList.remove("empty");break;case"allUnavailable":d.classList.add("unavailable");break;case"all":d.classList.remove("unavailable");break;case"noneUnavailable":u.classList.add("unavailable");break;case"none":u.classList.remove("unavailable")}}function L(){if(e.focus(),q(),t.classList.contains("loaded")&&x.postTitle===x.previousPostTitle)return;x.previousPostTitle=x.postTitle,t.classList.remove("message-error"),t.classList.add("loaded");const g={action:"dt_load_connections",loadConnectionsNonce:x.loadConnectionsNonce,postId:x.postId},y=O("dt-show-connections"),m=!!x.usexhr&&{withCredentials:!0};n().ajax({url:x.ajaxurl,xhrFields:m,method:"post",data:g}).done((e=>{if(!e.success||!e.data)return t.classList.remove("loaded"),void t.classList.add("message-error");if(r=e.data,"mustache"===y){const e={connections:[]};s().each(r,(t=>{"internal"===t.type&&(t.internal=!0),e.connections.push(t)})),t.innerHTML=C.render(S.getElementById("dt-show-connections").innerHTML,{connections:e.connections,foundConnections:e.connections.length,showSearch:5<e.connections.length,postTitle:x.postTitle}),v()}else t.innerHTML=y({connections:r,postTitle:x.postTitle});o=t.querySelector(".connections-selected"),i=t.querySelector(".selected-connections-list"),a=t.querySelector(".new-connections-list"),d=t.querySelector(".selectall-connections"),u=t.querySelector(".selectno-connections"),p=S.getElementById("dt-connection-search"),h=S.getElementById("dt-as-draft"),f=S.querySelector(".dt-error ul.details"),null!==a&&(c=a.querySelectorAll(".add-connection")),n()(p).on("keyup change",s().debounce((e=>{""===e.currentTarget.value&&b(),A=e.currentTarget.value.replace(/https?:\/\//i,"").replace(/www/i,"").replace(/[^0-9a-zA-Z ]+/,""),b()}),300)),s().each(c,(e=>{e.classList.contains("syndicated")||(d.classList.remove("unavailable"),l++)}))})).error((()=>{t.classList.remove("loaded"),t.classList.add("message-error")}))}y.parentNode.insertBefore(g,y.nextSibling);const T=S.querySelector("#wp-admin-bar-distributor > a");function q(){y.classList.contains("hover")||y.classList.contains("syncing")||S.body.classList.remove("is-showing-distributor")}T.addEventListener("keydown",(function(e){13===e.keyCode&&L()}),!1),S.body.classList.contains("is-fullscreen-mode")&&window.hoverintent(y,(function(){return null}),q).options({timeout:180}),T.addEventListener("touchstart",L,!1),T.addEventListener("mouseenter",L,!1),g.addEventListener("click",(function(){y.classList.contains("syncing")||(y.classList.contains("hover")&&(y.classList.remove("hover"),S.body.classList.remove("is-showing-distributor")),q())}),!0),n()(t).on("click",".syndicate-button",(()=>{if(y.classList.contains("syncing"))return;y.classList.add("syncing");const e={action:"dt_push",nonce:x.nonce,connections:j,postId:x.postId};e.postStatus=null!==h&&h.checked?"draft":x.postStatus;const a=!!x.usexhr&&{withCredentials:!0};n().ajax({url:x.ajaxurl,xhrFields:a,method:"post",data:e}).done((e=>{setTimeout((()=>{y.classList.remove("syncing"),q(),e.success?e.data&&e.data.results?function(e){let n=!1;const a={};["internal","external"].forEach((t=>{s().each(e[t],((e,o)=>{"success"===e.status&&(r[`${t}${o}`].syndicated=e.url,n=!0),s().isEmpty(e.errors)||(a[`${t}${o}`]=e.errors)}))})),s().isEmpty(a)||m(s().map(a,(function(e,t){return`${r[t].name}:\n${s().map(e,(function(e){return`- ${e}\n`}))}`}))),n&&s().isEmpty(a)&&(t.classList.add("message-success"),o.classList.add("empty"),i.innerText="",setTimeout((()=>{t.classList.remove("message-success")}),6e3)),j={},b()}(e.data.results):m((0,k.__)("Received empty result.","distributor")):m(e.data)}),500)})).error(((e,t,n)=>{setTimeout((()=>{y.classList.remove("syncing"),m(`${(0,k.__)("Ajax error:","distributor")} ${n}`)}),500)}))})),n()(t).on("click",".add-connection",(e=>{if("A"!==e.target.nodeName&&(e.preventDefault(),!e.currentTarget.classList.contains("syndicated")))if(e.currentTarget.classList.contains("added")){const t=e.currentTarget.getAttribute("data-connection-type"),n=e.currentTarget.getAttribute("data-connection-id"),r=i.querySelector(`[data-connection-id="${n}"][data-connection-type="${t}"]`);r.parentNode.removeChild(r),delete j[t+n],E=(0,k.sprintf)((0,k._n)("Selected connection (%d)","Selected connections (%d)",Object.keys(j).length,"distributor"),Object.keys(j).length),S.querySelector(".selected-connections-text").textContent=E,d.classList.contains("unavailable")&&w("all"),Object.keys(j).length||(w("addEmpty"),w("noneUnavailable")),b()}else{const t=e.currentTarget.getAttribute("data-connection-type"),n=e.currentTarget.getAttribute("data-connection-id");j[t+n]=r[t+n];const s=e.currentTarget.cloneNode(!0);E=(0,k.sprintf)((0,k._n)("Selected connection (%d)","Selected connections (%d)",Object.keys(j).length,"distributor"),Object.keys(j).length),S.querySelector(".selected-connections-text").textContent=E;const o=S.createElement("span");o.classList.add("remove-connection"),s.appendChild(o),s.classList="added-connection",i.appendChild(s),u.classList.contains("unavailable")&&(w("removeEmpty"),w("none")),Object.keys(j).length==l&&w("allUnavailable"),b()}})),n()(t).on("click",".selectall-connections",(()=>{n()(a).children(".add-connection").each(((e,t)=>{if(t.classList.contains("syndicated")||t.classList.contains("added"))return;const n=t.getAttribute("data-connection-type"),s=t.getAttribute("data-connection-id");j[n+s]=r[n+s];const o=t.cloneNode();o.innerText=t.innerText;const a=S.createElement("span");a.classList.add("remove-connection"),o.appendChild(a),o.classList="added-connection",E=(0,k.sprintf)((0,k._n)("Selected connection (%d)","Selected connections (%d)",Object.keys(j).length,"distributor"),Object.keys(j).length),S.querySelector(".selected-connections-text").textContent=E,i.appendChild(o),""!==l&&(w("removeEmpty"),w("allUnavailable"),w("none"))})),b()})),n()(t).on("click",".selectno-connections",(()=>{for(;i.firstChild;){const e=i.firstChild.getAttribute("data-connection-type"),t=i.firstChild.getAttribute("data-connection-id");delete j[e+t],E=(0,k.sprintf)((0,k._n)("Selected connection (%d)","Selected connections (%d)",Object.keys(j).length,"distributor"),Object.keys(j).length),S.querySelector(".selected-connections-text").textContent=E,i.removeChild(i.firstChild)}""!==l&&(w("addEmpty"),w("noneUnavailable"),w("all")),b()})),n()(t).on("click",".added-connection",(e=>{e.currentTarget.parentNode.removeChild(e.currentTarget);const t=e.currentTarget.getAttribute("data-connection-type"),n=e.currentTarget.getAttribute("data-connection-id");delete j[t+n],E=(0,k.sprintf)((0,k._n)("Selected connection (%d)","Selected connections (%d)",Object.keys(j).length,"distributor"),Object.keys(j).length),S.querySelector(".selected-connections-text").textContent=E,d.classList.contains("unavailable")&&w("all"),Object.keys(j).length||(w("addEmpty"),w("noneUnavailable")),b()}))}))})();