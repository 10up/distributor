!function(a){"use strict";var b={},c="",d=_.memoize(function(a){var b=document.getElementById(a);if(!b)return!1;var c={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g};return _.template(b.innerHTML,null,c)});a(window).load(function(){function e(){i.classList.add("message-error"),setTimeout(function(){i.classList.remove("message-error")},6e3)}function f(a){var c=!1;_.each(a.internal,function(a,b){"fail"===a.status?c=!0:sy_connections["internal"+b].syndicated=a.url}),_.each(a.external,function(a,b){"fail"===a.status?c=!0:sy_connections["external"+b].syndicated=!0}),c?e():(i.classList.add("message-success"),j.classList.add("empty"),k.innerHTML="",setTimeout(function(){i.classList.remove("message-success")},6e3)),b={},g()}function g(){l.innerHTML="",_.each(sy_connections,function(a,e){if(""!==c){var f=a.name.replace(/[^0-9a-zA-Z ]+/,"").match(c),g=a.url.replace(/https?:\/\//i,"").replace(/www/i,"").replace(/[^0-9a-zA-Z ]+/,"").match(c);if(!f&&!g)return}var h=d("sy-add-connection")({connection:a,selected:b[a.type+a.id]});l.innerHTML+=h})}var h=document.querySelector("#wp-admin-bar-syndicate a"),i=document.querySelector(".syndicate-push-wrapper"),j=i.querySelector(".connections-selected"),k=j.querySelector(".selected-connections-list"),l=i.querySelector(".new-connections-list"),m=document.getElementById("sy-connection-search"),n=i.querySelector(".syndicate-button"),o=i.querySelector(".action-wrapper");a(n).on("click",function(c){o.classList.contains("loading")||(o.classList.add("loading"),a.ajax({url:sy.ajaxurl,method:"post",data:{action:"sy_push",nonce:sy.nonce,connections:b,post_id:sy.post_id}}).done(function(a){setTimeout(function(){return o.classList.remove("loading"),a.data&&a.data.results?void f(a.data.results):void e()},500)}).error(function(){setTimeout(function(){o.classList.remove("loading"),e()},500)}))}),a(h).on("click",function(a){a.preventDefault(),document.body.classList.contains("syndicate-show")?h.blur():h.focus(),document.body.classList.toggle("syndicate-show")}),a(i).on("click",".add-connection",function(a){if("A"!==a.target.nodeName&&(a.preventDefault(),!a.currentTarget.classList.contains("syndicated")&&!a.currentTarget.classList.contains("added"))){var c=a.currentTarget.getAttribute("data-connection-type"),d=a.currentTarget.getAttribute("data-connection-id");b[c+d]=sy_connections[c+d],j.classList.remove("empty");var e=a.currentTarget.cloneNode();e.innerText=a.currentTarget.innerText,e.innerHTML+='<span class="remove-connection"></span>',e.classList="added-connection",k.appendChild(e),g()}}),a(i).on("click",".remove-connection",function(a){a.currentTarget.parentNode.parentNode.removeChild(a.currentTarget.parentNode);var c=a.currentTarget.parentNode.getAttribute("data-connection-type"),d=a.currentTarget.parentNode.getAttribute("data-connection-id");delete b[c+d],Object.keys(b).length||j.classList.add("empty"),g()}),a(m).on("keyup change",_.debounce(function(a){""===a.currentTarget.value&&g(sy_connections),c=a.currentTarget.value.replace(/https?:\/\//i,"").replace(/www/i,"").replace(/[^0-9a-zA-Z ]+/,""),g()},300))})}(jQuery);