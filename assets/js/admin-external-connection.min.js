!function(a){function b(b){if(m!==!1&&m.abort(),""==d.value)return j.innerHTML="<p>"+sy.no_connection_check+"</p>",void(k.innerText=sy.will_confirm_endpoint);k.classList.add("loading"),k.innerHTML=sy.endpoint_checking_message,f.classList.add("loading");var c={};_.each(h,function(a){if(!a.disabled){var b=a.getAttribute("data-auth-field");b&&(c[b]=a.value)}});var e=0;l&&l.value&&(e=l.value),m=a.ajax({url:ajaxurl,method:"post",data:{nonce:sy.nonce,action:"sy_verify_external_connection",auth:c,url:d.value,type:g.value,endpoint_id:e}}).done(function(a){a.success?(a.data.errors.no_external_connection?(k.innerHTML='<span class="dashicons dashicons-warning"></span>',k.innerHTML+=sy.invalid_endpoint,a.data.endpoint_suggestion&&(k.innerHTML+=" "+sy.endpoint_suggestion+' <a class="suggest">'+a.data.endpoint_suggestion+"</a>")):(!Object.keys(a.data.errors).length||1===Object.keys(a.data.errors).length&&a.data.errors.no_types)&&(k.innerHTML='<span class="dashicons dashicons-yes"></span>',k.innerHTML+=sy.valid_endpoint),j.innerHTML=n({errors:a.data.errors,can_post:a.data.can_post,can_get:a.data.can_get})):(b&&!b.currentTarget.classList.contains("external-connection-url-field")||(k.innerHTML='<span class="dashicons dashicons-warning"></span>',k.innerHTML+=sy.invalid_endpoint),j.innerHTML=n({errors:["no_external_connection"],can_post:[],can_get:[]}))}).complete(function(){f.classList.remove("loading"),k.classList.remove("loading")})}var c=_.memoize(function(a){var b=document.getElementById(a);if(!b)return!1;var c={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g};return _.template(b.innerHTML,null,c)}),d=document.getElementsByClassName("external-connection-url-field")[0],e=document.getElementById("sy_external_connection_details"),f=document.getElementById("sy_external_connection_connection"),g=document.getElementsByClassName("external-connection-type-field")[0],h=document.getElementsByClassName("auth-field"),i=document.getElementById("title"),j=document.querySelectorAll("#sy_external_connection_connection .inside")[0],k=document.querySelector(".endpoint-result"),l=document.getElementById("post_ID"),m=!1,n=c("sy-external-connection-verification");setTimeout(function(){b()},300),a(e).on("click",".suggest",function(b){d.value=b.currentTarget.innerText,a(d).trigger("input")}),a(e).on("keyup input",".auth-field, .external-connection-url-field",_.debounce(b,250)),a(d).on("blur",function(a){""===i.value&&""!==a.currentTarget.value&&(i.value=a.currentTarget.value.replace(/https?:\/\//i,""),i.focus(),i.blur())});var o=document.getElementById("sy_password"),p=document.getElementById("sy_username"),q=document.querySelector(".change-password");a(p).on("keyup change",_.debounce(function(){o.disabled=!1,o.value="",q.style.display="none"},250)),a(q).on("click",function(a){a.preventDefault(),o.disabled?(o.disabled=!1,o.value="",a.currentTarget.innerText=sy.cancel):(o.disabled=!0,a.currentTarget.innerText=sy.change)})}(jQuery);