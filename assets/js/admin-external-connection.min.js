!function(a){function b(b){if(!1!==l&&l.abort(),""===c.value)return j.innerText="",i.innerText="",void i.removeAttribute("data-endpoint-state");i.setAttribute("data-endpoint-state","loading"),i.innerText=dt.endpoint_checking_message,j.innerText="";var d={};_.each(f,function(a){if(!a.disabled){var b=a.getAttribute("data-auth-field");b&&(d[b]=a.value)}});var g=0;k&&k.value&&(g=k.value),l=a.ajax({url:ajaxurl,method:"post",data:{nonce:dt.nonce,action:"dt_verify_external_connection",auth:d,url:c.value,type:e.value,endpoint_id:g}}).done(function(a){if(a.success)if(a.data.errors.no_external_connection)if(i.setAttribute("data-endpoint-state","error"),a.data.endpoint_suggestion){i.innerText=dt.endpoint_suggestion+" ";var b=document.createElement("a");b.classList.add("suggest"),b.innerText=a.data.endpoint_suggestion,i.appendChild(b)}else i.innerText=dt.bad_connection;else if(a.data.errors.no_distributor||!a.data.can_post.length){i.setAttribute("data-endpoint-state","warning"),i.innerText=dt.limited_connection;var c=[];a.data.can_post.length||c.push(dt.bad_auth),a.data.errors.no_distributor&&c.push(dt.no_distributor),c.forEach(function(a){var b=document.createElement("li");b.innerText=a,j.append(b)})}else i.setAttribute("data-endpoint-state","valid"),i.innerText=dt.good_connection;else i.setAttribute("data-endpoint-state","error")}).complete(function(){i.classList.remove("loading")})}var c=(_.memoize(function(a){var b=document.getElementById(a);if(!b)return!1;var c={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g};return _.template(b.innerHTML,null,c)}),document.getElementsByClassName("external-connection-url-field")[0]),d=document.getElementById("dt_external_connection_details"),e=document.getElementsByClassName("external-connection-type-field")[0],f=document.getElementsByClassName("auth-field"),g=document.getElementsByClassName("dt-roles-allowed"),h=document.getElementById("title"),i=document.querySelector(".endpoint-result"),j=document.querySelector(".endpoint-errors"),k=document.getElementById("post_ID"),l=!1;setTimeout(function(){b()},300),a(d).on("click",".suggest",function(b){c.value=b.currentTarget.innerText,a(c).trigger("input")}),a(d).on("keyup input",".auth-field, .external-connection-url-field",_.debounce(b,250)),a(c).on("blur",function(a){""===h.value&&""!==a.currentTarget.value&&(h.value=a.currentTarget.value.replace(/https?:\/\//i,""),h.focus(),h.blur())});var m=document.getElementById("dt_password"),n=document.getElementById("dt_username"),o=document.querySelector(".change-password");a(n).on("keyup change",_.debounce(function(){o&&(m.disabled=!1,m.value="",o.style.display="none")},250)),a(o).on("click",function(a){a.preventDefault(),m.disabled?(m.disabled=!1,m.value="",a.currentTarget.innerText=dt.cancel):(m.disabled=!0,m.value="sdfdsfsdfdsfdsfsd",a.currentTarget.innerText=dt.change),b()}),a(g).on("click",".dt-role-checkbox",function(a){a.target.classList.contains("dt-role-checkbox")&&a.target.checked&&"administrator"!==a.target.value&&"editor"!==a.target.value&&alert(dt.roles_warning)})}(jQuery);